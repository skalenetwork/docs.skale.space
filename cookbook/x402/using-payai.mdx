---
title: "Using PayAI"
description: "Integrate PayAI facilitator for x402 payment processing"
---

## Using PayAI

PayAI is a hosted facilitator service that simplifies x402 payment processing. Instead of running your own facilitator infrastructure, you can use PayAI's endpoints to handle payment verification and settlement.

## What is PayAI?

PayAI provides:

- **Hosted Facilitator**: No need to deploy and maintain your own facilitator
- **Multi-Chain Support**: Works across multiple EVM networks including SKALE
- **High Availability**: Production-ready infrastructure with uptime guarantees
- **Easy Integration**: Simple API for verification and settlement

## Prerequisites

- Node.js and npm installed
- A SKALE Chain endpoint
- Basic understanding of x402 protocol
- PayAI API credentials (contact PayAI team)

## Configuration

### Environment Variables

Create a `.env` file with PayAI configuration:

```bash
# PayAI Facilitator URL
FACILITATOR_URL=https://facilitator.payai.example.com

# Your receiving address for payments
RECEIVING_ADDRESS=0xYourReceivingAddress

# Payment token configuration
PAYMENT_TOKEN_ADDRESS=0x61a26022927096f444994dA1e53F0FD9487EAfcf
PAYMENT_TOKEN_NAME="Axios USD"

# SKALE network configuration
NETWORK_CHAIN_ID=324705682

# Server port
PORT=3000
```

## Integration with PayAI

### Using Coinbase SDK

<Tabs>
  <Tab title="Server Setup">
    
    ```typescript
    import { Hono } from "hono";
    import { serve } from "@hono/node-server";
    import { paymentMiddleware, x402ResourceServer } from "@x402/hono";
    import { ExactEvmScheme } from "@x402/evm/exact/server";
    import { HTTPFacilitatorClient } from "@x402/core/server";
    import type { Network } from "@x402/core/types";
    import "dotenv/config";

    const app = new Hono();

    async function main() {
      // Point to PayAI facilitator
      const facilitatorUrl = process.env.FACILITATOR_URL!;
      const receivingAddress = process.env.RECEIVING_ADDRESS as `0x${string}`;
      const paymentTokenAddress = process.env.PAYMENT_TOKEN_ADDRESS as `0x${string}`;
      const paymentTokenName = process.env.PAYMENT_TOKEN_NAME || "Axios USD";
      const networkChainId = process.env.NETWORK_CHAIN_ID || "324705682";
      const network: Network = `eip155:${networkChainId}`;

      // Initialize PayAI facilitator client
      const facilitatorClient = new HTTPFacilitatorClient({ 
        url: facilitatorUrl 
      });
      
      const resourceServer = new x402ResourceServer(facilitatorClient);
      resourceServer.register("eip155:*", new ExactEvmScheme());

      // Apply payment middleware
      app.use(
        paymentMiddleware(
          {
            "GET /api/data": {
              accepts: [
                {
                  scheme: "exact",
                  network: network,
                  payTo: receivingAddress,
                  price: {
                    amount: "10000", // 0.01 tokens
                    asset: paymentTokenAddress,
                    extra: {
                      name: paymentTokenName,
                      version: "1",
                    },
                  },
                },
              ],
              description: "Premium data access",
              mimeType: "application/json",
            },
          },
          resourceServer
        )
      );

      // Protected endpoint
      app.get("/api/data", (c) => {
        return c.json({
          message: "Premium data unlocked via PayAI!",
          timestamp: new Date().toISOString(),
        });
      });

      const port = Number(process.env.PORT) || 3000;
      serve({ fetch: app.fetch, port }, () => {
        console.log(`Server running on http://localhost:${port}`);
        console.log(`Using PayAI facilitator: ${facilitatorUrl}`);
      });
    }

    main().catch(console.error);
    ```

  </Tab>
  <Tab title="Client Setup">

    ```typescript
    import { x402Client, x402HTTPClient } from "@x402/core/client";
    import { ExactEvmScheme } from "@x402/evm";
    import { privateKeyToAccount } from "viem/accounts";
    import "dotenv/config";

    async function main() {
      // Setup wallet
      const account = privateKeyToAccount(
        process.env.PRIVATE_KEY as `0x${string}`
      );

      // Create x402 client
      const evmScheme = new ExactEvmScheme(account);
      const coreClient = new x402Client().register("eip155:*", evmScheme);
      const httpClient = new x402HTTPClient(coreClient);

      // Access PayAI-protected resource
      const url = "http://localhost:3000/api/data";
      const response = await fetch(url);

      if (response.status === 402) {
        console.log("Payment required, processing via PayAI...");

        const responseBody = await response.json();
        const paymentRequired = httpClient.getPaymentRequiredResponse(
          (name: string) => response.headers.get(name),
          responseBody
        );

        const paymentPayload = await httpClient.createPaymentPayload(
          paymentRequired
        );
        
        const paymentHeaders = httpClient.encodePaymentSignatureHeader(
          paymentPayload
        );

        const paidResponse = await fetch(url, {
          headers: { ...paymentHeaders },
        });

        const data = await paidResponse.json();
        console.log("Data received:", data);
      }
    }

    main();
    ```

  </Tab>
</Tabs>

### Using Faremeter SDK

```typescript
import { createMiddleware } from "@faremeter/middleware/hono";
import { Hono } from "hono";
import { serve } from "@hono/node-server";
import "dotenv/config";

const app = new Hono();

async function main() {
  // Create payment middleware pointing to PayAI
  const paywalled = await createMiddleware({
    facilitatorURL: process.env.FACILITATOR_URL!,
    accepts: [
      {
        scheme: "exact",
        network: `eip155:${process.env.NETWORK_CHAIN_ID}`,
        amount: "10000",
        maxTimeoutSeconds: 300,
        payTo: process.env.RECEIVING_ADDRESS as `0x${string}`,
        asset: process.env.PAYMENT_TOKEN_ADDRESS as `0x${string}`,
        extra: {
          name: process.env.PAYMENT_TOKEN_NAME || "Axios USD",
          version: "1",
        },
      },
    ],
  });

  // Protected endpoint
  app.get("/api/data", paywalled, (c) => {
    return c.json({
      message: "Premium data unlocked via PayAI!",
      timestamp: new Date().toISOString(),
    });
  });

  serve({ fetch: app.fetch, port: 3000 });
}

main();
```

## Benefits of Using PayAI

### 1. No Infrastructure Management

PayAI handles all facilitator infrastructure:

- Server deployment and scaling
- Monitoring and alerting
- Updates and maintenance
- Security patches

### 2. Multi-Network Support

Works seamlessly across networks:

- SKALE chains (testnet and mainnet)
- Ethereum mainnet
- Other EVM-compatible chains
- Automatic network detection

### 3. High Availability

Production-ready infrastructure:

- 99.9% uptime SLA
- Redundant servers
- DDoS protection
- Automatic failover

### 4. Analytics & Monitoring

Built-in payment tracking:

- Transaction history
- Payment success rates
- Revenue analytics
- Real-time monitoring

## Advanced Configuration

### Custom Payment Options

Configure multiple payment options:

```typescript
const paymentOptions = [
  {
    scheme: "exact",
    network: "eip155:324705682",
    amount: "10000",
    asset: "0x61a26022927096f444994dA1e53F0FD9487EAfcf",
    payTo: receivingAddress,
    extra: { name: "Axios USD", version: "1" },
  },
  {
    scheme: "exact",
    network: "eip155:324705682",
    amount: "10000",
    asset: "0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",
    payTo: receivingAddress,
    extra: { name: "Bridged USDC", version: "1" },
  },
];
```

### Webhook Integration

Receive notifications for payments:

```typescript
app.post("/webhooks/payai", async (c) => {
  const payload = await c.req.json();
  
  // Verify webhook signature
  // Process payment notification
  
  console.log("Payment received:", payload);
  return c.json({ received: true });
});
```

## Troubleshooting

### Connection Issues

If you cannot connect to PayAI:

1. Verify the facilitator URL is correct
2. Check network connectivity
3. Ensure API credentials are valid
4. Review firewall settings

### Payment Failures

Common causes and solutions:

| Issue | Solution |
|-------|----------|
| Invalid signature | Verify wallet configuration and signing |
| Insufficient balance | Ensure payer has enough tokens |
| Network mismatch | Check chain ID matches configuration |
| Expired authorization | Increase `maxTimeoutSeconds` |

## Next Steps

<CardGroup cols={2}>
  <Card title="Using x402x" icon="layer-group" href="/cookbook/x402/using-x402x">
    Alternative facilitator with advanced features
  </Card>
  <Card title="Run Your Own" icon="server" href="/cookbook/x402/facilitator">
    Deploy your own facilitator infrastructure
  </Card>
  <Card title="Accept Payments" icon="dollar-sign" href="/cookbook/x402/accepting-payments">
    Protect endpoints with payment middleware
  </Card>
  <Card title="Make Payments" icon="credit-card" href="/cookbook/x402/buying">
    Build clients that handle x402 payments
  </Card>
</CardGroup>

## Resources

- [PayAI Documentation](https://docs.payai.example.com) (Coming Soon)
- [x402 Protocol Specification](https://x402.org)
- [Contact PayAI Team](mailto:support@payai.example.com)

---

<Note>
PayAI is a third-party service. Contact the PayAI team for access, pricing, and support information.
</Note>
